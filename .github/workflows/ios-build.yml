name: iOS Build & Archive

on:
  push:
    branches:
      - main  # Voer uit bij elke push naar main

jobs:
  build:
    runs-on: macos-latest  # Gebruik een macOS-runner

    steps:
      # 1. Haal de code op van de repository
      - name: ğŸ“¥ Haal de code op
        uses: actions/checkout@v3

      # 2. Installeer Flutter
      - name: ğŸ› ï¸ Installeer Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: 'stable'

      # 3. Installeer dependencies met Flutter
      - name: ğŸ“¦ Installeer dependencies
        run: flutter pub get

      # 4. Installeer CocoaPods voor iOS dependencies
      - name: ğŸ”§ Installeer CocoaPods
        run: |
          cd ios
          pod install

      # 5. Bouw de iOS-app zonder code signing
      - name: ğŸ—ï¸ Build iOS zonder codesigning
        run: flutter build ios --no-codesign

      # 6. Archiveer de app met Xcode
      - name: ğŸ“¦ Archiveer de app
        run: |
          cd ios
          xcodebuild -workspace Runner.xcworkspace \
          -scheme Runner \
          -sdk iphoneos \
          -configuration Release \
          archive -archivePath build/Runner.xcarchive

      # 7. Upload het iOS build artifact (de .xcarchive)
      - name: ğŸ“¤ Upload iOS build artifact
        uses: actions/upload-artifact@v2  # Gebruik versie v2, geen v3
        with:
          name: iOS-App
          path: ios/build/Runner.xcarchive
