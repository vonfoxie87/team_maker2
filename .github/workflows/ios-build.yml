name: iOS Build & Archive

on:
  push:
    branches:
      - main  # Voer uit bij elke push naar main

jobs:
  build:
    runs-on: macos-latest  # Gebruik een macOS-runner

    steps:
      # 1. Haal de code op van de repository
      - name: 📥 Haal de code op
        uses: actions/checkout@v3

      # 2. Installeer Flutter (specificeer de versie expliciet)
      - name: 🛠️ Installeer Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: 'stable'  # Specificeer het stable kanaal

      # 3. Controleer of Flutter correct is geïnstalleerd
      - name: 🔧 Controleer Flutter versie
        run: flutter --version

      # 4. Installeer dependencies met Flutter
      - name: 📦 Installeer dependencies
        run: flutter pub get

      # 5. Installeer CocoaPods voor iOS dependencies
      - name: 🔧 Installeer CocoaPods
        run: |
          cd ios
          pod install

      # 6. Bouw de iOS-app zonder code signing
      - name: 🏗️ Build iOS zonder codesigning
        run: flutter build ios --no-codesign

      # 7. Archiveer de app met Xcode
      - name: 📦 Archiveer de app
        run: |
          cd ios
          xcodebuild -workspace Runner.xcworkspace \
          -scheme Runner \
          -sdk iphoneos \
          -configuration Release \
          archive -archivePath build/Runner.xcarchive

      # 8. Upload het iOS build artifact (de .xcarchive)
      - name: 📤 Upload iOS build artifact
        uses: actions/upload-artifact@v4
        with:
          name: iOS-App
          path: ios/build/Runner.xcarchive
